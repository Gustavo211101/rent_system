{% extends "base.html" %}

{% block content %}
<div class="toolbar">
  <h1 style="margin:0;">Оборудование — ремонт</h1>

  <div style="display:flex; gap:10px; align-items:center;">
    <a class="btn-secondary" href="{% url 'equipment_list_categories' %}">Оборудование</a>
    {% if can_manage %}
      <a class="btn" href="{% url 'repair_add' %}">➕ В ремонт</a>
    {% endif %}
  </div>
</div>

<div style="display:flex; gap:10px; margin-bottom:12px;">
  <a class="btn-secondary" href="?status=active"{% if status == "active" %} style="font-weight:800;"{% endif %}>Активные</a>
  <a class="btn-secondary" href="?status=closed"{% if status == "closed" %} style="font-weight:800;"{% endif %}>Закрытые</a>
  <a class="btn-secondary" href="?status=all"{% if status == "all" %} style="font-weight:800;"{% endif %}>Все</a>
</div>

<table class="list-table">
  <thead>
    <tr>
      <th>Оборудование</th>
      <th>Категория</th>
      <th>Кол-во</th>
      <th>Статус</th>
      <th>Начато</th>
      <th>Закончено</th>
      <th>Комментарий</th>
      <th>Действия</th>
    </tr>
  </thead>
  <tbody>
    {% for r in repairs %}
      <tr>
        <td>{{ r.equipment.name }}</td>
        <td>{{ r.equipment.category.name }}</td>
        <td>{{ r.quantity }}</td>
        <td>{{ r.get_status_display }}</td>
        <td>{{ r.start_date|date:"d.m.Y" }}</td>
        <td>{% if r.end_date %}{{ r.end_date|date:"d.m.Y" }}{% else %}—{% endif %}</td>
        <td style="max-width:260px;">{{ r.note|default:"—" }}</td>
        <td>
          <div style="display:flex; flex-direction:column; gap:8px; align-items:flex-start;">
            {% if r.status == "in_repair" %}
              <form method="post" action="{% url 'repair_close' r.id %}" onsubmit="return confirm('Отметить как возвращённое из ремонта?')">
                {% csrf_token %}
                <button type="submit" class="btn-secondary">Вернуть</button>
              </form>
            {% endif %}
            <form method="post" action="{% url 'repair_delete' r.id %}" onsubmit="return confirm('Удалить запись ремонта?')">
              {% csrf_token %}
              <button type="submit" class="btn-secondary" style="border-color:#ef4444; color:#ef4444;">Удалить</button>
            </form>
          </div>
        </td>
      </tr>
    {% empty %}
      <tr><td colspan="8" style="color:#6b7280;">Записей ремонта нет.</td></tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
