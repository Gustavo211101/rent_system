{% extends "base.html" %}

{% block title %}–ö–∞—Ä—Ç–æ—á–∫–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è{% endblock %}

{% block content %}
<h1>–ö–∞—Ä—Ç–æ—á–∫–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è</h1>

<div class="card" style="max-width: 920px;">
  <div style="display:flex; gap:24px; flex-wrap:wrap; align-items:flex-start;">
    <div style="min-width:260px;">
      {% if item.photo %}
        <img src="{{ item.photo.url }}" alt="–§–æ—Ç–æ" style="max-width:260px; max-height:260px; object-fit:contain; border:1px solid #e5e7eb; border-radius:8px; padding:8px; background:#fff;" />
      {% else %}
        <div style="width:260px; height:260px; display:flex; align-items:center; justify-content:center; border:1px dashed #cbd5e1; border-radius:8px; color:#64748b;">
          –§–æ—Ç–æ –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ
        </div>
      {% endif %}

      <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
        <a class="btn" href="{% url 'stock_item_qr' type_id=eq_type.id item_id=item.id %}">–®—Ç—Ä–∏—Ö–∫–æ–¥</a>
        <a class="btn" href="{% url 'stock_item_label_print' type_id=eq_type.id item_id=item.id %}" target="_blank">–ü–µ—á–∞—Ç—å</a>
        <a class="btn btn-outline" href="{% url 'stock_items_list' type_id=eq_type.id %}">–ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
      </div>
    </div>

    <div style="flex:1; min-width:320px;">
      <h2 style="margin-top:0;">{{ eq_type.name }}</h2>

      <table style="width:100%; border-collapse:collapse;">
        <tr>
          <td style="padding:6px 10px; color:#64748b;">–ò–Ω–≤–µ–Ω—Ç–∞—Ä–Ω—ã–π –Ω–æ–º–µ—Ä</td>
          <td style="padding:6px 10px; font-weight:600;">{{ item.inventory_number }}</td>
        </tr>
        <tr>
          <td style="padding:6px 10px; color:#64748b;">–°—Ç–∞—Ç—É—Å</td>
          <td style="padding:6px 10px;">{{ item.get_status_display }}</td>
        </tr>
        <tr>
          <td style="padding:6px 10px; color:#64748b;">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</td>
          <td style="padding:6px 10px;">{{ item.comment|default:"‚Äî" }}</td>
        </tr>
        <tr>
          <td style="padding:6px 10px; color:#64748b;">–°–æ–∑–¥–∞–Ω–æ</td>
          <td style="padding:6px 10px;">{{ item.created_at|date:"d.m.Y H:i" }}</td>
        </tr>
      </table>

      {% if open_repair %}
        <div class="card" style="margin-top:14px; padding:12px; border:1px solid #fde68a; background:#fffbeb;">
          <div style="font-weight:700; margin-bottom:6px;">üîß –°–µ–π—á–∞—Å –≤ —Ä–µ–º–æ–Ω—Ç–µ</div>
          <div style="color:#7c2d12; margin-bottom:10px;">
            <b>–ü—Ä–∏—á–∏–Ω–∞:</b> {{ open_repair.reason|truncatechars:120 }}
            <a href="{% url 'stock_repair_detail' repair_id=open_repair.id %}" style="margin-left:8px;">–û—Ç–∫—Ä—ã—Ç—å</a>
          </div>

          {% if can_manage %}
            <a class="btn" href="{% url 'stock_item_repair_close' type_id=eq_type.id item_id=item.id %}">–í–µ—Ä–Ω—É—Ç—å –Ω–∞ —Å–∫–ª–∞–¥</a>
          {% endif %}
        </div>
      {% else %}
        {% if can_manage %}
          <div style="margin-top:14px;">
            <a class="btn" href="{% url 'stock_item_repair_open' type_id=eq_type.id item_id=item.id %}">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ —Ä–µ–º–æ–Ω—Ç</a>
          </div>
        {% endif %}
      {% endif %}

      <hr style="margin:18px 0;" />

      <h3 style="margin:0 0 10px 0;">–ò—Å—Ç–æ—Ä–∏—è —Ä–µ–º–æ–Ω—Ç–æ–≤</h3>

      {% if repairs %}
        <div class="card" style="padding:0; overflow:hidden;">
          <table style="width:100%; border-collapse:collapse;">
            <thead>
              <tr style="background:#f8fafc; border-bottom:1px solid #e5e7eb;">
                <th style="text-align:left; padding:10px; width:150px;">–û—Ç–∫—Ä—ã—Ç</th>
                <th style="text-align:left; padding:10px; width:150px;">–ó–∞–∫—Ä—ã—Ç</th>
                <th style="text-align:left; padding:10px;">–ó–∞–º–µ—Ç–∫–∏</th>
                <th style="text-align:left; padding:10px; width:120px;">–î–µ–π—Å—Ç–≤–∏—è</th>
              </tr>
            </thead>
            <tbody>
              {% for r in repairs %}
                <tr style="border-bottom:1px solid #f1f5f9;">
                  <td style="padding:10px;">{{ r.opened_at|date:"d.m.Y H:i" }}</td>
                  <td style="padding:10px;">
                    {% if r.closed_at %}
                      {{ r.closed_at|date:"d.m.Y H:i" }}
                    {% else %}
                      <span style="padding:3px 8px; border-radius:999px; background:#fffbeb; border:1px solid #fde68a;">–í —Ä–µ–º–æ–Ω—Ç–µ</span>
                    {% endif %}
                  </td>
                  <td style="padding:10px;">
                    <div><b>–ü—Ä–∏—á–∏–Ω–∞:</b> {{ r.reason|truncatechars:90 }}</div>
                    <div style="margin-top:4px; color:#64748b;">
                      <b>–í–æ–∑–≤—Ä–∞—Ç:</b>
                      {% if r.close_note %}{{ r.close_note|truncatechars:90 }}{% else %}‚Äî{% endif %}
                    </div>
                  </td>
                  <td style="padding:10px;">
                    <a class="btn" href="{% url 'stock_repair_detail' repair_id=r.id %}">–û—Ç–∫—Ä—ã—Ç—å</a>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <div style="color:#64748b;">–†–µ–º–æ–Ω—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ –±—ã–ª–æ.</div>
      {% endif %}

      <hr style="margin:18px 0;" />

      <h3 style="margin:0 0 10px 0;">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–∏–ø–∞</h3>
      <table style="width:100%; border-collapse:collapse;">
        <tr>
          <td style="padding:6px 10px; color:#64748b;">–í–µ—Å</td>
          <td style="padding:6px 10px;">{% if eq_type.weight_kg %}{{ eq_type.weight_kg }} –∫–≥{% else %}‚Äî{% endif %}</td>
        </tr>
        <tr>
          <td style="padding:6px 10px; color:#64748b;">–ì–∞–±–∞—Ä–∏—Ç—ã</td>
          <td style="padding:6px 10px;">{% if eq_type.dimensions_mm %}{{ eq_type.dimensions_mm }} –º–º{% else %}‚Äî{% endif %}</td>
        </tr>
        <tr>
          <td style="padding:6px 10px; color:#64748b;">–ü–∏—Ç–∞–Ω–∏–µ</td>
          <td style="padding:6px 10px;">{% if eq_type.power_w %}{{ eq_type.power_w }} W{% else %}‚Äî{% endif %}</td>
        </tr>
      </table>

      <p style="margin-top:14px; color:#64748b;">
        –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (—Ä–∞–∑–º–µ—Ä—ã, –≤–µ—Å, —ç–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –∏ —Ç.–¥.) –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å –ø–æ–∑–∂–µ.
      </p>
    </div>
  </div>
</div>
{% endblock %}