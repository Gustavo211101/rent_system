# Архитектура проекта (кратко)

## 1) Общая идея

Проект — веб-система планирования мероприятий с календарём, ролями пользователей и складским контуром (склад будет описан отдельно).

В центре системы:
- мероприятия
- календарь планирования
- распределение ответственности между ролями

Архитектура построена модульно (Django apps).

Ключевой принцип:
Backend определяет, что можно делать, UI только отражает доступы.
При этом часть UI-логики (скрытие кнопок, подсказки) допустима для удобства пользователя.

---

## 2) Приложения Django

### accounts
Назначение: пользователи, роли и доступы.

Содержит:
- кастомную модель пользователя
- роли (Django Groups)
- управление персоналом
- регистрацию по ссылке
- context processors с флагами прав

Важно:
- пользователь может иметь несколько ролей
- кабинет пользователя не управляет ролями

---

### events
Назначение: основной бизнес-модуль — мероприятия и календарь.

Содержит:
- модель Event
- календарь месяца
- карточку мероприятия
- корзину (soft delete)
- команду мероприятия
- оборудование и аренду в рамках мероприятия

Важно:
- events — центр системы
- фильтрация мероприятий зависит от ролей

---

### cabinet
Назначение: персональная панель пользователя.

Содержит:
- профиль пользователя
- список мероприятий
- просмотр ролей (read-only)
- редактирование личных данных

Кабинет — точка ориентации пользователя, а не административный интерфейс.

---

### notifications
Назначение: уведомления пользователей.

Сейчас — вспомогательный сервис.
В будущем — важная часть процесса.

---

### audit
Назначение: восстановление контекста действий.

Журнал используется для:
- понимания истории изменений
- диагностики ошибок

---

## 3) Поток данных

Пользователь → View → Queryset → Template

Backend проверяет права.
Шаблоны отображают данные и скрывают элементы UI.

---

## 4) Права и роли

Источник истины:
docs/roles_and_permissions.md

---

## 5) Шаблоны и CSS

- base.html
- base.css
- calendar.css

Новые CSS подключаются поверх.
Большие шаблоны не заменяются целиком.

---

## 6) Настройки и окружения

- dev / prod
- SQLite локально
- Postgres на сервере
- ngrok — только dev

---

## 7) Принципы развития

1. Одна фича — один набор файлов
2. Сначала документ → потом код
3. Не трогать working-части
4. Откатываться — нормально
5. Не делать несколько фич одновременно

---

## 8) Хрупкие места

- events/views.py
- календарь
- карточка мероприятия
- проверки прав
