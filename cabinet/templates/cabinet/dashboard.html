{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="cabinet-page">

    <!-- === PROFILE CARD === -->
    <div class="cabinet-card cabinet-profile">

        <div class="cabinet-profile-header">
            <div class="cabinet-avatar">
                {{ user.first_name|default:user.username|slice:":1"|upper }}
            </div>

            <div class="cabinet-profile-info">
                <h1 class="cabinet-title">Кабинет</h1>

                <div class="cabinet-user-meta">
                    <div><strong>Пользователь:</strong> {{ user.username }}</div>
                    <div><strong>Имя:</strong> {{ user.get_full_name|default:"—" }}</div>
                    <div><strong>Email:</strong> {{ user.email|default:"—" }}</div>
                </div>
            </div>

            <div class="cabinet-role">
                <span class="role-badge role-{{ role_slug }}">
                    {{ role_name }}
                </span>
            </div>
        </div>

        <div class="cabinet-actions">
            <a href="{% url 'cabinet:profile_edit' %}" class="btn">
                Редактировать профиль
            </a>
            <a href="{% url 'cabinet:password_change' %}" class="btn">
                Сменить пароль
            </a>
        </div>
    </div>

    <!-- === STATS === -->
    <div class="cabinet-stats">
        <div class="stat-card">
            <div class="stat-value">{{ stats.total }}</div>
            <div class="stat-label">Всего мероприятий</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ stats.upcoming }}</div>
            <div class="stat-label">Предстоящие</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ stats.past }}</div>
            <div class="stat-label">Прошедшие</div>
        </div>
    </div>

    <!-- === EVENTS === -->
    <div class="cabinet-card">
        <h2 class="cabinet-section-title">Мои мероприятия</h2>

        {% if upcoming_events %}
        <div class="cabinet-subtitle">Ближайшие</div>
        <table class="list-table">
            <thead>
                <tr>
                    <th>Дата</th>
                    <th>Название</th>
                    <th>Роль</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for item in upcoming_events %}
                <tr>
                    <td>{{ item.date_display }}</td>
                    <td>{{ item.event.name }}</td>
                    <td>
                        <span class="role-pill role-{{ item.role_slug }}">
                            {{ item.role_name }}
                        </span>
                    </td>
                    <td>
                        <a href="{% url 'event_detail' item.event.id %}" class="btn btn-secondary">
                            Открыть
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}

        {% if past_events %}
        <div class="cabinet-subtitle cabinet-subtitle-muted">Прошедшие</div>
        <table class="list-table list-table-muted">
            <tbody>
                {% for item in past_events %}
                <tr>
                    <td>{{ item.date_display }}</td>
                    <td>{{ item.event.name }}</td>
                    <td>
                        <span class="role-pill role-muted">
                            {{ item.role_name }}
                        </span>
                    </td>
                    <td>
                        <a href="{% url 'event_detail' item.event.id %}" class="btn btn-secondary">
                            Открыть
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}

        {% if not upcoming_events and not past_events %}
          <p style="margin: 12px 0 0; color: #6b7280;">Вы пока не прикреплены ни к одному мероприятию.</p>
        {% endif %}
    </div>

</div>
{% endblock %}
