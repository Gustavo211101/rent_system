{% extends "base.html" %}

{% block content %}
<div class="toolbar">
  <h1 style="margin:0;">Корзина мероприятий</h1>

  <div style="display:flex; gap:10px;">
    <a class="btn-secondary" href="{% url 'event_list' %}">← Назад</a>
  </div>
</div>

<p style="color:#6b7280; margin-top:0;">
  Здесь мероприятия, удалённые “мягко”. Их можно восстановить или удалить навсегда.
</p>

<table class="list-table">
  <thead>
    <tr>
      <th>Удалено</th>
      <th>Название</th>
      <th>Период</th>
      <th>Клиент</th>
      <th>Локация</th>
      <th style="width:260px;">Действия</th>
    </tr>
  </thead>

  <tbody>
    {% for e in events %}
    <tr>
      <td>
        {% if e.deleted_at %}
          {{ e.deleted_at|date:"d.m.Y H:i" }}
        {% else %}
          —
        {% endif %}
      </td>
      <td>{{ e.name }}</td>
      <td>
        {% if e.start_date == e.end_date or not e.end_date %}
          {{ e.start_date|date:"d.m.Y" }}
        {% else %}
          {{ e.start_date|date:"d.m.Y" }} – {{ e.end_date|date:"d.m.Y" }}
        {% endif %}
      </td>
      <td>{{ e.client }}</td>
      <td>{{ e.location }}</td>
      <td>
        <div style="display:flex; flex-direction:column; gap:8px; align-items:flex-start;">
          <a class="btn-secondary" href="{% url 'event_detail' e.id %}">Открыть</a>

          <form method="post" action="{% url 'event_restore' e.id %}"
                onsubmit="return confirm('Восстановить мероприятие «{{ e.name }}»?')">
            {% csrf_token %}
            <button type="submit" class="btn">Восстановить</button>
          </form>

          <form method="post" action="{% url 'event_purge' e.id %}"
                onsubmit="return confirm('Удалить навсегда мероприятие «{{ e.name }}»? Это действие необратимо.')">
            {% csrf_token %}
            <button type="submit" class="btn-secondary" style="border-color:#ef4444; color:#ef4444;">
              Удалить навсегда
            </button>
          </form>
        </div>
      </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="6" style="color:#6b7280;">Корзина пуста.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
