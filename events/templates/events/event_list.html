{% extends "base.html" %}

{% block content %}
<div class="toolbar">
  <h1 style="margin:0;">–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h1>
{% if not can_view_all_events %}
  <div class="muted" style="margin: 6px 0 12px;">
    –ü–æ–∫–∞–∑–∞–Ω—ã —Ç–æ–ª—å–∫–æ –≤–∞—à–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è (–≥–¥–µ –≤—ã —É—á–∞—Å—Ç–≤—É–µ—Ç–µ)
  </div>
{% endif %}
  <div style="display:flex; gap:10px; align-items:center;">
    {% if can_create_event %}
      <a class="btn" href="{% url 'event_create' %}">+ –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</a>
    {% endif %}

    {% if can_delete %}
      <a class="btn-secondary" href="{% url 'event_trash' %}">üóë –ö–æ—Ä–∑–∏–Ω–∞</a>
    {% endif %}
  </div>
</div>

<table class="list-table">
  <thead>
    <tr>
      <th>–°—Ç–∞—Ç—É—Å</th>
      <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
      <th>–ü–µ—Ä–∏–æ–¥</th>
      <th>–ö–ª–∏–µ–Ω—Ç</th>
      <th>–õ–æ–∫–∞—Ü–∏—è</th>
      <th>–î–µ–π—Å—Ç–≤–∏—è</th>
    </tr>
  </thead>

  <tbody>
    {% for e in events %}
    <tr>
      <td>
        <span class="status-pill status-{{ e.status }}">{{ e.get_status_display }}</span>
      </td>
      <td>{{ e.name }}</td>
      <td>
        {% if e.start_date == e.end_date or not e.end_date %}
          {{ e.start_date|date:"d.m.Y" }}
        {% else %}
          {{ e.start_date|date:"d.m.Y" }} ‚Äì {{ e.end_date|date:"d.m.Y" }}
        {% endif %}
      </td>
      <td>{{ e.client }}</td>
      <td>{{ e.location }}</td>
      <td>
        <div style="display:flex; flex-direction:column; gap:8px; align-items:flex-start;">
          <a class="btn-secondary" href="{% url 'event_detail' e.id %}">–û—Ç–∫—Ä—ã—Ç—å</a>

          {% if can_edit %}
            <a class="btn-secondary" href="{% url 'event_edit' e.id %}">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
          {% endif %}

          {% if can_delete %}
            <form method="post" action="{% url 'event_delete' e.id %}"
                  onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ ¬´{{ e.name }}¬ª? –û–Ω–æ –ø–æ–ø–∞–¥—ë—Ç –≤ –∫–æ—Ä–∑–∏–Ω—É –Ω–∞ 30 –¥–Ω–µ–π.')">
              {% csrf_token %}
              <button type="submit" class="btn-secondary" style="border-color:#ef4444; color:#ef4444;">
                –£–¥–∞–ª–∏—Ç—å
              </button>
            </form>
          {% endif %}
        </div>
      </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="6" style="color:#6b7280;">–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –Ω–µ—Ç.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
