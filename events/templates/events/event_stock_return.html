{% extends "base.html" %}

{% block content %}
<div class="page-head">
  <div>
    <h1 style="margin:0;">–í–æ–∑–≤—Ä–∞—Ç (—Å–∫–∞–Ω–µ—Ä) ‚Äî {{ event.name }}</h1>
    <div class="muted" style="margin-top:6px;">
      {% if event.start_date == event.end_date %}
        {{ event.start_date|date:"d.m.Y" }}
      {% else %}
        {{ event.start_date|date:"d.m.Y" }} ‚Äì {{ event.end_date|date:"d.m.Y" }}
      {% endif %}
    </div>
  </div>

  <div class="page-actions" style="display:flex; gap:10px; flex-wrap:wrap;">
    <a class="btn-secondary" href="{% url 'event_stock_load' event.id %}">üöö –ü–æ–≥—Ä—É–∑–∫–∞</a>
    <a class="btn-secondary" href="{% url 'event_detail' event.id %}">‚Üê –ù–∞–∑–∞–¥ –∫ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—é</a>
  </div>
</div>

<div class="card" style="margin-top:18px;">
  <h2 style="margin-top:0;">–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—Ç–∞</h2>

  <form method="post" style="display:flex; gap:10px; align-items:flex-end; flex-wrap:wrap;">
    {% csrf_token %}
    <div style="min-width:320px;">
      <label class="muted" for="code"><strong>–°–∫–∞–Ω–∏—Ä—É–π / –≤–≤–µ–¥–∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–Ω—ã–π –Ω–æ–º–µ—Ä</strong></label>
      <input id="code" name="code" type="text" autocomplete="off" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 100100" style="width:100%; padding:10px; font-size:16px;">
      <div class="muted" style="margin-top:6px;">–°–∫–∞–Ω–µ—Ä –æ–±—ã—á–Ω–æ –≤–≤–æ–¥–∏—Ç –∫–æ–¥ –∏ –Ω–∞–∂–∏–º–∞–µ—Ç Enter.</div>
    </div>
    <button class="btn" type="submit" style="height:42px;">–í–µ—Ä–Ω—É—Ç—å</button>
  </form>

  <div style="margin-top:14px;" class="muted">
    –°–µ–π—á–∞—Å –Ω–µ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–æ: <strong>{{ active_count }}</strong>
  </div>
</div>

<div class="card" style="margin-top:18px;">
  <h2 style="margin-top:0;">–ù–µ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–æ (–≤—ã–¥–∞–Ω–æ –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ)</h2>

  {% if active_issues %}
    <table class="list-table">
      <thead>
        <tr>
          <th style="width:170px;">–ò–Ω–≤–µ–Ω—Ç–∞—Ä–Ω–∏–∫</th>
          <th>–¢–∏–ø</th>
          <th style="width:180px;">–í—ã–¥–∞–Ω–æ</th>
        </tr>
      </thead>
      <tbody>
        {% for iss in active_issues %}
          <tr>
            <td><strong>{{ iss.item.inventory_number }}</strong></td>
            <td>
              {{ iss.item.equipment_type.name }}
              <div class="muted" style="margin-top:2px;">
                {{ iss.item.equipment_type.category.name }}
                {% if iss.item.equipment_type.subcategory %} / {{ iss.item.equipment_type.subcategory.name }}{% endif %}
              </div>
            </td>
            <td>{{ iss.issued_at|date:"d.m.Y H:i" }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <div class="muted">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤—ã–¥–∞—á ‚Äî –≤—Å—ë –≤–æ–∑–≤—Ä–∞—â–µ–Ω–æ ‚úÖ</div>
  {% endif %}
</div>

<script>
  // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å: —É–¥–æ–±–Ω–æ –¥–ª—è —Å–∫–∞–Ω–µ—Ä–∞
  (function(){
    const el = document.getElementById('code');
    if (el) {
      el.focus();
      el.addEventListener('blur', () => setTimeout(() => el.focus(), 50));
    }
  })();
</script>
{% endblock %}
